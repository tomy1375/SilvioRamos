import{S as r}from"./sweetalert2.esm.all.B0Dix5B2.js";function E(){if(!document.querySelector('link[href*="sweetalert2.min.css"]')){const n=document.createElement("link");n.rel="stylesheet",n.href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css",document.head.appendChild(n),console.log("Estilos de SweetAlert2 cargados.")}}function y(){console.log("Configurando botones de eliminar para planos..."),document.querySelectorAll(".eliminar-plano").forEach(function(t){const e=document.createElement("button");e.type="button",e.className=t.className,e.innerHTML=t.innerHTML,e.dataset.id=t.getAttribute("data-id")||"",e.dataset.nombre=t.getAttribute("data-nombre")||"",e.addEventListener("click",function(){const i=this.getAttribute("data-id"),l=this.getAttribute("data-nombre"),c=this.closest("tr");if(!i||!l){console.error("Faltan atributos de datos en el botón");return}r.fire({title:"¿Está seguro?",text:`¿Desea eliminar el plano "${l}"?`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(a=>{a.isConfirmed&&i&&B(i,c)})});const o=t.parentNode;o?o.replaceChild(e,t):console.error("No se pudo encontrar el nodo padre del botón")})}function C(){console.log("Configurando filtros para planos...");const n=document.getElementById("buscarNombre"),t=document.getElementById("buscarCliente"),e=document.getElementById("filtrarTipo");n&&n.addEventListener("input",u),t&&t.addEventListener("input",u),e&&e.addEventListener("change",u)}function B(n,t){r.fire({title:"Eliminando...",text:"Por favor espere",allowOutsideClick:!1,didOpen:()=>{r.showLoading()}}),fetch("/api/eliminar-plano",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:n})}).then(function(e){return e.json()}).then(function(e){if(e.success){t&&t.remove();const o=document.getElementById("planosTableBody");if(o&&o.children.length===0){const i=o.closest(".relative");i&&(i.innerHTML=`
              <div class="text-center py-8">
                <p class="text-muted-foreground">No hay planos disponibles. Sube tu primer plano.</p>
              </div>
            `)}r.fire({title:"¡Eliminado!",text:"El plano ha sido eliminado correctamente.",icon:"success",confirmButtonColor:"#3085d6"})}else r.fire({title:"Error",text:e.error||"No se pudo eliminar el plano",icon:"error",confirmButtonColor:"#3085d6"})}).catch(function(e){console.error("Error al eliminar el plano:",e),r.fire({title:"Error",text:"Error al eliminar el plano. Por favor, inténtelo de nuevo.",icon:"error",confirmButtonColor:"#3085d6"})})}function u(){const n=document.getElementById("buscarNombre"),t=document.getElementById("buscarCliente"),e=document.getElementById("filtrarTipo");if(!n||!t||!e)return;const o=n.value.toLowerCase(),i=t.value.toLowerCase(),l=e.value.toLowerCase(),c=document.querySelectorAll(".plano-row");let a=!1;c.forEach(function(s){const p=s.getAttribute("data-nombre")||"",f=s.getAttribute("data-cliente")||"",b=s.getAttribute("data-tipo")||"",g=!o||p.includes(o),h=!i||f.includes(i);g&&h&&(!l||b===l)?(s.style.display="",a=!0):s.style.display="none"});const d=document.getElementById("noResultados");d&&(a?d.classList.add("hidden"):d.classList.remove("hidden"))}function m(){console.log("Inicializando página de planos..."),E(),y(),C()}document.addEventListener("DOMContentLoaded",m);document.addEventListener("astro:page-load",m);setTimeout(m,0);
