import{j as e}from"./jsx-runtime.D_zvdyIk.js";import{r as s}from"./index.Dy6lLLXr.js";function A({usuarios:l=[]}){const[a,p]=s.useState(""),[d,m]=s.useState("Arquitectónico"),[c,f]=s.useState(""),[b,x]=s.useState(""),[u,g]=s.useState(null),[h,v]=s.useState(""),[k,j]=s.useState(""),[y,t]=s.useState(!1),[N,o]=s.useState(""),[w,S]=s.useState(""),C=i=>{const r=i.target.files[0];r&&(g(r),v(r.name),j(E(r.size)))},E=i=>i<1024?i+" bytes":i<1048576?(i/1024).toFixed(1)+" KB":(i/1048576).toFixed(1)+" MB",q=async i=>{i.preventDefault(),t(!0),o(""),S("");try{if(!a||!d||!c||!u){o("Por favor, complete todos los campos requeridos."),t(!1);return}if(u.type!=="application/pdf"){o("El archivo debe ser un PDF."),t(!1);return}const r=new FormData;r.append("nombre",a),r.append("tipo",d),r.append("cliente",c),r.append("descripcion",b),r.append("archivo",u);const F=await fetch("/api/subir-plano",{method:"POST",body:r}),n=await F.json();F.ok?(S("Plano subido correctamente."),p(""),m("Arquitectónico"),f(""),x(""),g(null),v(""),j(""),document.getElementById("archivo").value=""):(o(`Error al subir el plano: ${n.error||"Ocurrió un error desconocido"}`),n.setupUrl&&o(`${n.error} <a href="${n.setupUrl}" class="text-primary hover:underline">Configurar base de datos</a>`))}catch(r){console.error("Error al subir el plano:",r),o("Error al procesar la solicitud. Por favor, inténtelo de nuevo.")}finally{t(!1)}};return e.jsxs("form",{onSubmit:q,className:"space-y-6",children:[N&&e.jsx("div",{className:"bg-destructive/15 text-destructive p-4 rounded-md",dangerouslySetInnerHTML:{__html:N}}),w&&e.jsx("div",{className:"bg-green-100 text-green-800 p-4 rounded-md",children:w}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"nombre",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Nombre del Plano *"}),e.jsx("input",{type:"text",id:"nombre",value:a,onChange:i=>p(i.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"tipo",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Tipo de Plano *"}),e.jsxs("select",{id:"tipo",value:d,onChange:i=>m(i.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"Arquitectónico",children:"Arquitectónico"}),e.jsx("option",{value:"Estructural",children:"Estructural"}),e.jsx("option",{value:"Eléctrico",children:"Eléctrico"}),e.jsx("option",{value:"Hidráulico",children:"Hidráulico"}),e.jsx("option",{value:"Sanitario",children:"Sanitario"}),e.jsx("option",{value:"Otro",children:"Otro"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"cliente",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Cliente *"}),e.jsxs("select",{id:"cliente",value:c,onChange:i=>f(i.target.value),required:!0,className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",children:[e.jsx("option",{value:"",children:"Seleccione un cliente"}),l.length===0?e.jsx("option",{value:"",disabled:!0,children:"No hay clientes disponibles"}):l.map(i=>e.jsxs("option",{value:i.id,children:[i.nombre," (ID: ",i.id,")"]},i.id))]}),l.length===0&&e.jsx("p",{className:"text-xs text-red-500 mt-1",children:"No se encontraron clientes. Verifique la base de datos."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"archivo",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Archivo PDF *"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx("input",{type:"file",id:"archivo",accept:"application/pdf",onChange:C,required:!0,className:"hidden"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"archivo",className:"inline-flex h-10 items-center justify-center rounded-md border border-input bg-background px-4 py-2 text-sm font-medium shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 cursor-pointer",children:"Seleccionar archivo"}),h&&e.jsxs("span",{className:"text-sm text-muted-foreground",children:[h," (",k,")"]})]})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"descripcion",className:"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",children:"Descripción"}),e.jsx("textarea",{id:"descripcion",value:b,onChange:i=>x(i.target.value),rows:"4",className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:y,className:"inline-flex h-10 items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground shadow transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50",children:y?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Subiendo..."]}):"Subir Plano"})})]})}export{A as default};
